<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unit 11: Entertainment - Interactive Lesson</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --success: #27ae60; --danger: #e74c3c; --bg: #f0f2f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; background: white; border-radius: 15px; overflow: hidden; shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* Tabs Styling */
        .tabs { display: flex; background: var(--primary); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: white; cursor: pointer; font-weight: bold; font-size: 0.9rem; transition: 0.3s; opacity: 0.7; }
        .tab-btn.active { opacity: 1; border-bottom: 4px solid var(--secondary); background: rgba(255,255,255,0.1); }
        
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* General UI */
        h2 { font-size: 1.2rem; color: var(--primary); margin-bottom: 15px; border-left: 4px solid var(--secondary); padding-left: 10px; }
        .item-row { margin-bottom: 15px; display: flex; flex-direction: column; }
        .input-group { display: flex; align-items: center; gap: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        .correct-ans { color: var(--danger); font-size: 0.85rem; font-weight: bold; margin-top: 5px; display: none; }
        
        /* Buttons */
        .verify-btn { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--success); color: white; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .audio-btn { background: var(--secondary); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-bottom: 5px; }
        
        /* Part 3 Speaking */
        .speaking-card { background: #f8f9fa; border: 1px solid #eee; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .record-btn { background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .recording-active { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <button class="tab-btn active" onclick="openTab(event, 'part1')">VOCAB</button>
        <button class="tab-btn" onclick="openTab(event, 'part2')">LISTEN</button>
        <button class="tab-btn" onclick="openTab(event, 'part3')">SPEAK</button>
    </div>

    <div id="part1" class="tab-content active">
        <h2>Vocabulary Recall (10 words)</h2>
        <div id="vocab-container"></div>
        <button class="verify-btn" onclick="verifyVocab()">Verify Vocabulary</button>
    </div>

    <div id="part2" class="tab-content">
        <h2>Listening & Fill in Blanks</h2>
        <audio controls style="width: 100%; margin-bottom: 15px;">
            <source src="unit11_audio.mp3" type="audio/mpeg">
        </audio>
        <div id="listening-container" style="line-height: 2;"></div>
        <button class="verify-btn" onclick="verifyListen()">Verify Listening</button>
    </div>

    <div id="part3" class="tab-content">
        <h2>Speaking Practice (5 sentences)</h2>
        <div id="speaking-container"></div>
    </div>
</div>

<script>
    // Data
    const vocabData = [
        { vn: "Hành động", en: "action" }, { vn: "Trượt patin", en: "rollerblading" },
        { vn: "Dã ngoại", en: "picnic" }, { vn: "Cốt truyện", en: "story" },
        { vn: "Tập thể dục", en: "exercise" }, { vn: "Trận đấu", en: "game" },
        { vn: "Đi bơi", en: "swimming" }, { vn: "Cát", en: "sand" },
        { vn: "Quần jeans", en: "jeans" }, { vn: "Áo sơ mi", en: "shirts" }
    ];

    const listenData = [
        "D1: My friend said the (1) [story] is great. It’s full of (2) [action].",
        "D2: It’ll be perfect for (3) [swimming]. Lie on the (4) [sand] and (5) [sleep].",
        "D3: What time is the (6) [game]? Are you (7) [playing]?",
        "D4: What to do this (8) [weekend]? Let's go (9) [rollerblading].",
        "D5: I need some (10) [jeans] and (11) [shirts].",
        "D6: It's great (12) [exercise]. Have a (13) [picnic] in the park."
    ];

    const speakSentences = [
        "This weekend, I want to go swimming and watch an action movie.",
        "The story of this movie is great and it is full of action.",
        "I need to buy some new jeans and shirts on Saturday afternoon.",
        "Let's get the guys and go rollerblading in the park.",
        "It's great exercise, so maybe we can have a picnic there."
    ];

    // Tab Logic
    function openTab(evt, tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        evt.currentTarget.classList.add('active');
    }

    // Load Part 1
    const vContainer = document.getElementById('vocab-container');
    vocabData.forEach((v, i) => {
        vContainer.innerHTML += `
            <div class="item-row">
                <span>${i+1}. ${v.vn}:</span>
                <div class="input-group">
                    <input type="text" id="v-input-${i}">
                </div>
                <div class="correct-ans" id="v-ans-${i}">Correct: ${v.en}</div>
            </div>`;
    });

    // Load Part 2
    const lContainer = document.getElementById('listening-container');
    let qIdx = 1;
    listenData.forEach((text, i) => {
        let processed = text.replace(/\[(.*?)\]/g, () => {
            let html = `<input type="text" id="q-input-${qIdx}" style="width:80px"> <span class="correct-ans" id="q-ans-${qIdx}"></span>`;
            qIdx++;
            return html;
        });
        lContainer.innerHTML += `<div style="margin-bottom:15px">${processed}</div>`;
    });

    // Load Part 3
    const sContainer = document.getElementById('speaking-container');
    speakSentences.forEach((s, i) => {
        sContainer.innerHTML += `
            <div class="speaking-card">
                <p><strong>Sentence ${i+1}:</strong> ${s}</p>
                <button class="audio-btn" onclick="playSample(${i})">Listen Model</button>
                <button class="record-btn" id="rec-${i}" onclick="toggleRecord(${i})">Record</button>
                <audio id="playback-${i}" controls style="display:none; width:100%; margin-top:10px"></audio>
            </div>`;
    });

    // Verification Logic
    function verifyVocab() {
        vocabData.forEach((v, i) => {
            const input = document.getElementById(`v-input-${i}`);
            const ans = document.getElementById(`v-ans-${i}`);
            if(input.value.toLowerCase().trim() !== v.en) {
                ans.style.display = 'block';
                input.style.borderColor = 'var(--danger)';
            } else {
                ans.style.display = 'none';
                input.style.borderColor = 'var(--success)';
            }
        });
    }

    function verifyListen() {
        const answers = ["story", "action", "swimming", "sand", "sleep", "game", "playing", "weekend", "rollerblading", "jeans", "shirts", "exercise", "picnic"];
        answers.forEach((a, i) => {
            const idx = i + 1;
            const input = document.getElementById(`q-input-${idx}`);
            const ans = document.getElementById(`q-ans-${idx}`);
            if(input.value.toLowerCase().trim() !== a) {
                ans.innerHTML = `(${a})`;
                ans.style.display = 'inline';
                input.style.borderColor = 'var(--danger)';
            } else {
                ans.style.display = 'none';
                input.style.borderColor = 'var(--success)';
            }
        });
    }

    // Speaking Logic
    let mediaRecorder;
    let chunks = [];
    async function toggleRecord(id) {
        const btn = document.getElementById(`rec-${id}`);
        if (!mediaRecorder || mediaRecorder.state === 'inactive') {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            chunks = [];
            mediaRecorder.ondataavailable = e => chunks.push(e.data);
            mediaRecorder.onstop = () => {
                const blob = new Blob(chunks, { type: 'audio/wav' });
                const player = document.getElementById(`playback-${id}`);
                player.src = URL.createObjectURL(blob);
                player.style.display = 'block';
            };
            mediaRecorder.start();
            btn.innerHTML = "Stop";
            btn.classList.add('recording-active');
        } else {
            mediaRecorder.stop();
            btn.innerHTML = "Record";
            btn.classList.remove('recording-active');
        }
    }

    function playSample(i) {
        alert("Playing model audio for sentence " + (i+1));
        // Bạn có thể thay bằng: new Audio(`speak${i}.mp3`).play();
    }
</script>

</body>
</html>
